# Лаборатораня работа №1
***
## Задание
Реализовать имитацию рабочего стола используя светодиодную панель P10 и джойстик.

***

## SPI ##
**SPI (Serial Peripheral Interface)** - последовательный синхронный стандарт передачи данных в режиме полного дуплекса, 
предназначенный для обеспечения простого и недорогого высокоскоростного сопряжения микроконтроллеров и периферии

Любая отладочная плата серии STM32 обладает возможностью реализаци подобного способа передачи данных.

**О процессе передачи данных**

Процесс передачи осуществляется последовательно, с формированием пакетов объёмом 1 байт ( 8 бит). Однако, бывают 
случаи, когда его объём уменьшается до 4 бит.

![SPI communication system.png](Additional%20files%2FSPI%20communication%20system.png)

 
Подлежащие передаче данные ведущее и ведомое устройства помещают в сдвиговые регистры. После этого ведущее 
устройство начинает генерировать импульсы синхронизации на линии *SCLK*, что приводит к взаимному обмену данными. 
Передача данных осуществляется бит за битом от ведущего по линии *MOSI* и от ведомого по линии *MISO*. Передача 
осуществляется, как правило, начиная со старших битов, но некоторые производители допускают изменение порядка 
передачи битов программными методами.

***
## P10 ##

Светодиодная панель представляет из себя белую матрицу 32x16 точек с размерами 320x160мм.


![P10.jpg](Additional%20files%2FP10.jpg)![LEDP10_RED.png]

Это основные характеристики данной рабочей матрицы. Дальше рассмотрим **обратную сторону панели***:

![Position of components.jpg](Additional%20files%2FPosition%20of%20components.jpg)

Под цифрами обозначены различные узлы данной системы
1. **1 x SM74HC245D** — неинвертирующий буфер
2. **1 x 88SM74HC04** — 6-канальный инвертор
3. **1 x SM74HC138D** — 8-битный дешифратор
4. **4 x PM4953** — сборка из 2 P-канальных MOSFET
5. **16 x 74HC595D** — сдвиговый регистр с защёлкой

Два 16-пиновых разъёма — интерфейсные, один из них входной (к нему подключается контроллер экрана), а второй — выходной (к нему подключается следующая матрица в цепочке). Стрелка на плате направлена от входного разъёма к выходному.
Питание подаётся на клеммы в центре платы. Напряжение питания — 5В, максимальный ток (когда включены все светодиодны матрицы) — 2А (для белой матрицы).

Ниже приведено принципиальная схема устройства.

![Schematic diagram.gif](Additional%20files%2FSchematic%20diagram.gif)

*******

## Подключение к светодиодной матрице LEDP10 ##

Ниже приведёна распиновка разъема матрицы:

![Pinout contacts.jpg](Additional%20files%2FPinout%20contacts.jpg)

Назначение каждого из пинов
- **A** и **B** - необходим для переключения между строками
- **OE** - отвечает за запуск / отключение матрицы
- **SCK** - канал для синхронизации частот работы переферии
- **MOSI** - канал передачи данных
- **SCLK** - канал подтверждения конца загрузки байта данных.

******************
## Настрйока микроконтроллера и SPI

На изображении выше можно наблюдать изображение микроконтроллера с всеми активными пинами.

![PINS_MK.png](https://github.com/Mister1-cat/P10/blob/main/Additional%20files/PINS_MK.jpg)

Ниже можно наблюдать настройки SPI

![Setings_SPI5.png](Additional%20files%2FSetings_SPI5.png)

*******************
 ## Последовательность для загрузки данных в матрицу ###

1. Выдаём по SPI данные для сдвиговых регистров. Для одной матрицы 32x16 это 16 байт (16 8-битных регистров).
2. Устанавливаем лог. 0 на ножке nOE.
3. Устанавливаем лог. уровни на ножках A и B в соответствии с обновляемой группой светодиодов (одной из четырёх). Это подаёт +5В на аноды светодиодов выбранной группы.
4. Выдаём на ножку SCLK короткий положительный импульс. Это подаёт землю на катоды светодиодов в соответствии с загруженными в регистры байтами.
5. Устанавливаем лог. 1 на ножке nOE. При этом четверть экрана (одна группа светодиодов) загорается и горит до следующего обновления следующей группы светодиодов.
Повторяем пункты 1-5 с постоянным периодом.

*******************

## Листинги и описание, алгоритмы кода

Вся информация данного типа находится внутри отчёта под названием "1 лабораторная".

Код находится внутри файла `/lab1/Core/Src/main.c`, а используемые библиотеки: `/lab1/Core/Src/P10.c` и `/lab1/Core/Inc/P10.h`

*******************
 ## Демонстрация работы панели ###
![Setings_SPI5.png](Additional%20files%2FSetings_SPI5.png)


